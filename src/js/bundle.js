!function(e){var t={};function o(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){o(1),e.exports=o(2)},function(e,t,o){"use strict";customElements.define("phone-validation",class extends HTMLElement{constructor(){super(),this._mask="",this._correctNumber="+7(985)077-**-**",this._inputsMaskArr=[],this.template=document.createElement("template").innerHTML='\n        <div class="phone-module">\n            <div class="phone-module__number-section"></div>\n            <div class="phone-module__error-section"></div>\n        </div>\n    ',this.attachShadow({mode:"open"}),this.shadowRoot&&(this.shadowRoot.innerHTML=this.template,this._numberSection=this.shadowRoot.querySelector(".phone-module__number-section"),this._errorSection=this.shadowRoot.querySelector(".phone-module__error-section"))}logic(){if(console.log("step 2"),this.shadowRoot&&(this._numberSection=this.shadowRoot.querySelector(".phone-module__number-section"),this._errorSection=this.shadowRoot.querySelector(".phone-module__error-section")),this._numberSection){let e=1;console.log("step 3");for(let t=0;t<this._mask.length;t++)switch(this._mask[t]){case"+":case"(":case")":case"-":{let e=document.createElement("div");e.className="phone-module__number-section-symbol",e.innerText=this._mask[t],this._numberSection.appendChild(e);break}case"I":{let o=document.createElement("input");o.className="phone-module__number-section-input",o.id=String(e),o.placeholder="_",this._numberSection.appendChild(o),this._inputsMaskArr.push(t),e++;break}case"*":{let e=document.createElement("div");e.className="phone-module__number-section-cell",e.innerText="•",e.style.fontSize="25px",this._numberSection.appendChild(e);break}case"X":default:{let e=document.createElement("div");e.className="phone-module__number-section-cell",e.innerText=this._mask[t],this._numberSection.appendChild(e);break}}let t=[],o=e;for(let o=1;o<=e;o++){let e=document.getElementById(String(o));e&&t.push(e)}let n=new RegExp("^[0-9]+$");console.log(this._mask);for(let e=0;e<t.length;e++)t[e].addEventListener("input",()=>{if(t[e].className="phone-module__number-section-input",n.test(t[e].value)){if(t[e].value.length>1&&(t[e].value=t[e].value[t[e].value.length-1]),Number(t[e].id)<o){let o=document.getElementById(String(Number(t[e].id)+1));o&&o.focus()}"phone-module__number-section-input-error"==t[e].className&&(t[e].className="phone-module__number-section-input")}else console.log(t[e].value,parseInt(t[e].value)),t[e].value.length>=2?isNaN(Number(t[e].value))?(console.log(t[e].value),t[e].value=t[e].value[1]):(console.log("da"),t[e].value=t[e].value[0]):t[e].value=""});console.log("step 4"),document.addEventListener("keypress",e=>{if(console.log("step 5:",e.keyCode),13==e.keyCode){console.log("da");let e=!1;if(this._errorSection){this._errorSection.textContent="";for(let t=0;t<o;t++){let o=document.getElementById(String(t+1));if(o){if(""==o.value)return this._errorSection.textContent="Все поля должны быть заполены",void(o.className="phone-module__number-section-input-error");o.value!=this._correctNumber[this._inputsMaskArr[t]]&&(console.log(o,"cur: ",o.value,"ist: ",this._correctNumber[this._inputsMaskArr[t]]),e=!0)}}let t;if(e){for(let e=0;e<o;e++)(t=document.getElementById(String(e+1)))&&(t.className="phone-module__number-section-input-error");this._errorSection.textContent="Неверный номер, попробуйте еще раз"}else for(let e=0;e<o;e++)(t=document.getElementById(String(e+1)))&&(t.className="phone-module__error-section-input-success")}}})}else console.log("root",this.shadowRoot,"elem",this._numberSection)}set setMask(e){this._mask=e._mask,console.log("step1"),this.logic()}get getMask(){return this._mask}});var n=document.getElementById("7");if(n){let e={_mask:"+7(985)0II-**-**"};n.setMask=e,console.log("wtf")}else console.log("err")},function(e,t){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3RzL2luZGV4LnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiY3VzdG9tRWxlbWVudHMiLCJkZWZpbmUiLCJIVE1MRWxlbWVudCIsIltvYmplY3QgT2JqZWN0XSIsInN1cGVyIiwidGhpcyIsIl9tYXNrIiwiX2NvcnJlY3ROdW1iZXIiLCJfaW5wdXRzTWFza0FyciIsInRlbXBsYXRlIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwiYXR0YWNoU2hhZG93Iiwic2hhZG93Um9vdCIsIl9udW1iZXJTZWN0aW9uIiwicXVlcnlTZWxlY3RvciIsIl9lcnJvclNlY3Rpb24iLCJjb25zb2xlIiwibG9nIiwiaWQiLCJsZW5ndGgiLCJjZWxsIiwiY2xhc3NOYW1lIiwiaW5uZXJUZXh0IiwiYXBwZW5kQ2hpbGQiLCJTdHJpbmciLCJwbGFjZWhvbGRlciIsInB1c2giLCJzdHlsZSIsImZvbnRTaXplIiwiaW5wdXRzQXJyIiwiaW5wdXRzQ29sIiwiaW5wdXQiLCJnZXRFbGVtZW50QnlJZCIsInJnIiwiUmVnRXhwIiwiYWRkRXZlbnRMaXN0ZW5lciIsInRlc3QiLCJOdW1iZXIiLCJuZXh0SW5wdXQiLCJmb2N1cyIsInBhcnNlSW50IiwiaXNOYU4iLCJldmVudCIsImtleUNvZGUiLCJlcnJDaGVjayIsInRleHRDb250ZW50Iiwic2V0TWFzayIsInByb3AiLCJsb2dpYyIsImdldE1hc2siLCJhIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBYixFQUFBaUIsT0FBQUMsWUFBQSxDQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFBc0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEsSUFBQUYsRUFBQXJCLEVBQUFxQixJQUNBLEVBQUFFLEVBQUEsT0FBQUYsRUFDQSxLQUFBRSxHQUFBLGlCQUFBRixRQUFBRyxXQUFBLE9BQUFILEVBQ0EsSUFBQUksRUFBQVgsT0FBQVksT0FBQSxNQUdBLEdBRkExQixFQUFBa0IsRUFBQU8sR0FDQVgsT0FBQUMsZUFBQVUsRUFBQSxXQUF5Q1QsWUFBQSxFQUFBSyxVQUN6QyxFQUFBRSxHQUFBLGlCQUFBRixFQUFBLFFBQUFNLEtBQUFOLEVBQUFyQixFQUFBVSxFQUFBZSxFQUFBRSxF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QW1CLElBQWZBLEVBQU1oRCxNQUdOLE9BRkFvQixLQUFLWSxjQUFjOEIsWUFBYyxxQ0FDakNkLEVBQU1WLFVBQVksNENBR2xCVSxFQUFNaEQsT0FBU29CLEtBQUtFLGVBQWVGLEtBQUtHLGVBQWV4QyxNQUV2RGtELFFBQVFDLElBQUljLEVBQU8sUUFBU0EsRUFBTWhELE1BQU8sUUFBU29CLEtBQUtFLGVBQWVGLEtBQUtHLGVBQWV4QyxLQUUxRjhFLEdBQVcsSUFLdkIsSUFBSWIsRUFFSixHQUFJYSxFQUFVLENBQ1YsSUFBSyxJQUFJOUUsRUFBSSxFQUFHQSxFQUFJZ0UsRUFBV2hFLEtBQzNCaUUsRUFBcUJ2QixTQUFTd0IsZUFBZVIsT0FBTzFELEVBQUksT0FHcERpRSxFQUFNVixVQUFZLDRDQUcxQmxCLEtBQUtZLGNBQWM4QixZQUFjLDBDQUVqQyxJQUFLLElBQUkvRSxFQUFJLEVBQUdBLEVBQUlnRSxFQUFXaEUsS0FDM0JpRSxFQUFxQnZCLFNBQVN3QixlQUFlUixPQUFPMUQsRUFBSSxPQUdwRGlFLEVBQU1WLFVBQVksc0RBUTFDTCxRQUFRQyxJQUFJLE9BQVFkLEtBQUtTLFdBQVksT0FBUVQsS0FBS1UsZ0JBSTFEaUMsWUFBWUMsR0FDUjVDLEtBQUtDLE1BQVEyQyxFQUFLM0MsTUFDbEJZLFFBQVFDLElBQUksU0FDWmQsS0FBSzZDLFFBR1RDLGNBQ0ksT0FBTzlDLEtBQUtDLFNBSXBCLElBQUk4QyxFQUErQjFDLFNBQVN3QixlQUFlLEtBQzNELEdBQUlrQixFQUFHLENBQ0gsSUFBSXRELEVBQVksQ0FDWlEsTUFBUSxvQkFFWjhDLEVBQUVKLFFBQVVsRCxFQUVab0IsUUFBUUMsSUFBSSxZQUlaRCxRQUFRQyxJQUFJIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImludGVyZmFjZSBQcm9wcyB7XG4gICAgLyoqXG4gICAgICog0JzQsNGB0LrQsCDQuNC90L/Rg9GC0LAuINCX0L3QsNGH0LXQvdC40Y86XG4gICAgICogXCJJXCIgLSDQvtC00LjQvdC+0YfQvdGL0Lkg0LjQvdC/0YPRgiDQtNC70Y8g0LLQstC+0LTQsCDQvtC00L3QvtC5INGG0LjRhNGA0YtcbiAgICAgKiBcIlhcIiAtINGB0LXRgNGL0Lkg0LHQu9C+0Log0YEg0YHQuNC80LLQvtC70L7QvCBcIlhcIlxuICAgICAqIFwiKlwiIC0g0YHQtdGA0YvQuSDQsdC70L7QuiDRgSDRgdC40LzQstC+0LvQvtC8IFwi4pePXCJcbiAgICAgKiA80YbQuNGE0YDQsD4gLSDRgdC10YDRi9C5INCx0LvQvtC6INGBINCy0LLQtdC00LXQvdC90L7QuSDRhtC40YTRgNC+0LlcbiAgICAgKiA80L3QtSDRhtC40YTRgNCwPiAtINGB0LjQvNCy0L7QuyDQvtGC0L7QsdGA0LDQttCw0LXRgtGB0Y8gXCLQutCw0Log0LXRgdGC0YxcIlxuICAgICAqL1xuICAgIF9tYXNrOiBzdHJpbmcsXG59XG5cbmNsYXNzIHBob25lVmFsaWRhdGlvbkNvbXBvbmVudCBleHRlbmRzIEhUTUxFbGVtZW50e1xuICAgIFxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuYXR0YWNoU2hhZG93KHttb2RlOiBcIm9wZW5cIn0pO1xuXG5cbiAgICAgICAgaWYgKHRoaXMuc2hhZG93Um9vdCkge1xuICAgICAgICAgICAgdGhpcy5zaGFkb3dSb290LmlubmVySFRNTCA9IHRoaXMudGVtcGxhdGU7XG5cbiAgICAgICAgICAgIHRoaXMuX251bWJlclNlY3Rpb24gPSB0aGlzLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcignLnBob25lLW1vZHVsZV9fbnVtYmVyLXNlY3Rpb24nKTtcbiAgICAgICAgICAgIHRoaXMuX2Vycm9yU2VjdGlvbiA9IHRoaXMuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKCcucGhvbmUtbW9kdWxlX19lcnJvci1zZWN0aW9uJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDQntCx0YrRj9Cy0LvRj9C10Lwg0L/QtdGA0LXQtdC90L3Ri9C1XG4gICAgcHJpdmF0ZSBfbWFzayAgPSAnJztcbiAgICBwcml2YXRlIF9jb3JyZWN0TnVtYmVyID0gJys3KDk4NSkwNzctKiotKionO1xuICAgIHByaXZhdGUgX251bWJlclNlY3Rpb24gOiBhbnk7XG4gICAgcHJpdmF0ZSBfZXJyb3JTZWN0aW9uIDogYW55O1xuICAgIHByaXZhdGUgX2lucHV0c01hc2tBcnIgOiBBcnJheTxudW1iZXI+ID0gW107XG4gICAgcHJpdmF0ZSBfcm9vdCA6IGFueTtcblxuICAgIC8vINCX0LDQtNCw0LXQvCDRiNCw0LHQu9C+0L0sINCyINC60L7RgtC+0YDRi9C5INCx0YPQtNC10YIg0L/QvtC80LXRidC10L0g0LLQsNC70LjQtNC40YDRg9C10LzRi9C5INC90L7QvNC10YBcbiAgICBwcml2YXRlIHRlbXBsYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGVtcGxhdGUnKS5pbm5lckhUTUwgPSBgXG4gICAgICAgIDxkaXYgY2xhc3M9XCJwaG9uZS1tb2R1bGVcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwaG9uZS1tb2R1bGVfX251bWJlci1zZWN0aW9uXCI+PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwicGhvbmUtbW9kdWxlX19lcnJvci1zZWN0aW9uXCI+PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICBwdWJsaWMgbG9naWMoKSA6IHZvaWQge1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCdzdGVwIDInKTtcblxuICAgICAgICBpZiAodGhpcy5zaGFkb3dSb290KSB7XG4gICAgICAgICAgICB0aGlzLl9udW1iZXJTZWN0aW9uID0gdGhpcy5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoJy5waG9uZS1tb2R1bGVfX251bWJlci1zZWN0aW9uJyk7XG4gICAgICAgICAgICB0aGlzLl9lcnJvclNlY3Rpb24gPSB0aGlzLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcignLnBob25lLW1vZHVsZV9fZXJyb3Itc2VjdGlvbicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuX251bWJlclNlY3Rpb24pIHtcbiAgICAgICAgICAgIGxldCBpZCA9IDE7XG4gICAgXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3RlcCAzJyk7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fbWFzay5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHN3aXRjaCh0aGlzLl9tYXNrW2ldKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJysnOiBcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnKCc6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJyknOlxuICAgICAgICAgICAgICAgICAgICBjYXNlICctJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuY2xhc3NOYW1lID0gJ3Bob25lLW1vZHVsZV9fbnVtYmVyLXNlY3Rpb24tc3ltYm9sJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuaW5uZXJUZXh0ID0gdGhpcy5fbWFza1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX251bWJlclNlY3Rpb24uYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXNlICdJJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5jbGFzc05hbWUgPSAncGhvbmUtbW9kdWxlX19udW1iZXItc2VjdGlvbi1pbnB1dCc7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmlkID0gU3RyaW5nKGlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwucGxhY2Vob2xkZXIgPSAnXyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9udW1iZXJTZWN0aW9uLmFwcGVuZENoaWxkKGNlbGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5wdXRzTWFza0Fyci5wdXNoKGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJyonOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5jbGFzc05hbWUgPSAncGhvbmUtbW9kdWxlX19udW1iZXItc2VjdGlvbi1jZWxsJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuaW5uZXJUZXh0ID0gJ+KAoic7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLnN0eWxlLmZvbnRTaXplID0gJzI1cHgnO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbnVtYmVyU2VjdGlvbi5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ1gnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5jbGFzc05hbWUgPSAncGhvbmUtbW9kdWxlX19udW1iZXItc2VjdGlvbi1jZWxsJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuaW5uZXJUZXh0ID0gdGhpcy5fbWFza1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX251bWJlclNlY3Rpb24uYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5jbGFzc05hbWUgPSAncGhvbmUtbW9kdWxlX19udW1iZXItc2VjdGlvbi1jZWxsJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuaW5uZXJUZXh0ID0gdGhpcy5fbWFza1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX251bWJlclNlY3Rpb24uYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgICAgICBsZXQgaW5wdXRzQXJyIDogQXJyYXk8SFRNTElucHV0RWxlbWVudD4gPSBbXTtcbiAgICAgICAgICAgIGxldCBpbnB1dHNDb2wgPSBpZDtcbiAgICBcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IGlkOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgaW5wdXQgPSA8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChTdHJpbmcoaSkpO1xuICAgICAgICAgICAgICAgIGlmIChpbnB1dCl7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0c0Fyci5wdXNoKGlucHV0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcmcgOiBSZWdFeHAgPSBuZXcgUmVnRXhwKCdeWzAtOV0rJCcpO1xuICAgICAgICBcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuX21hc2spXG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgID0gMDsgaSA8IGlucHV0c0Fyci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlucHV0c0FycltpXS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGlucHV0c0FycltpXS5jbGFzc05hbWUgPSAncGhvbmUtbW9kdWxlX19udW1iZXItc2VjdGlvbi1pbnB1dCc7IFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJnLnRlc3QoaW5wdXRzQXJyW2ldLnZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0c0FycltpXS52YWx1ZS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRzQXJyW2ldLnZhbHVlID0gaW5wdXRzQXJyW2ldLnZhbHVlW2lucHV0c0FycltpXS52YWx1ZS5sZW5ndGgtMV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChOdW1iZXIoaW5wdXRzQXJyW2ldLmlkKSkgPCBpbnB1dHNDb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbmV4dElucHV0IDogSFRNTElucHV0RWxlbWVudCA9IDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFN0cmluZyhOdW1iZXIoaW5wdXRzQXJyW2ldLmlkKSArIDEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV4dElucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRJbnB1dC5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0c0FycltpXS5jbGFzc05hbWUgPT0gJ3Bob25lLW1vZHVsZV9fbnVtYmVyLXNlY3Rpb24taW5wdXQtZXJyb3InKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRzQXJyW2ldLmNsYXNzTmFtZSA9ICdwaG9uZS1tb2R1bGVfX251bWJlci1zZWN0aW9uLWlucHV0JztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGlucHV0c0FycltpXS52YWx1ZSwgcGFyc2VJbnQoaW5wdXRzQXJyW2ldLnZhbHVlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXRzQXJyW2ldLnZhbHVlLmxlbmd0aCA+PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc05hTihOdW1iZXIoaW5wdXRzQXJyW2ldLnZhbHVlKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2RhJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRzQXJyW2ldLnZhbHVlID0gaW5wdXRzQXJyW2ldLnZhbHVlWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGlucHV0c0FycltpXS52YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRzQXJyW2ldLnZhbHVlID0gaW5wdXRzQXJyW2ldLnZhbHVlWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRzQXJyW2ldLnZhbHVlID0gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0ZXAgNCcpO1xuICAgICAgICBcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0ZXAgNTonLCBldmVudC5rZXlDb2RlKTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSAxMykge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZGEnKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGVyckNoZWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9lcnJvclNlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Vycm9yU2VjdGlvbi50ZXh0Q29udGVudCA9ICcnO1xuICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRzQ29sOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW5wdXQgOiBIVE1MSW5wdXRFbGVtZW50ID0gPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoU3RyaW5nKGkgKyAxKSlcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWUgPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Vycm9yU2VjdGlvbi50ZXh0Q29udGVudCA9ICfQktGB0LUg0L/QvtC70Y8g0LTQvtC70LbQvdGLINCx0YvRgtGMINC30LDQv9C+0LvQtdC90YsnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2xhc3NOYW1lID0gJ3Bob25lLW1vZHVsZV9fbnVtYmVyLXNlY3Rpb24taW5wdXQtZXJyb3InO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZSAhPSB0aGlzLl9jb3JyZWN0TnVtYmVyW3RoaXMuX2lucHV0c01hc2tBcnJbaV1dKSB7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhpbnB1dCwgJ2N1cjogJywgaW5wdXQudmFsdWUsICdpc3Q6ICcsIHRoaXMuX2NvcnJlY3ROdW1iZXJbdGhpcy5faW5wdXRzTWFza0FycltpXV0pXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJDaGVjayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9ICAgXG4gICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbnB1dDogSFRNTEVsZW1lbnQ7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJDaGVjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRzQ29sOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSA8SFRNTEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoU3RyaW5nKGkgKyAxKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5jbGFzc05hbWUgPSAncGhvbmUtbW9kdWxlX19udW1iZXItc2VjdGlvbi1pbnB1dC1lcnJvcic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXJyb3JTZWN0aW9uLnRleHRDb250ZW50ID0gJ9Cd0LXQstC10YDQvdGL0Lkg0L3QvtC80LXRgCwg0L/QvtC/0YDQvtCx0YPQudGC0LUg0LXRidC1INGA0LDQtyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0c0NvbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0ID0gPEhUTUxFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFN0cmluZyhpICsgMSkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2xhc3NOYW1lID0gJ3Bob25lLW1vZHVsZV9fZXJyb3Itc2VjdGlvbi1pbnB1dC1zdWNjZXNzJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicm9vdFwiLCB0aGlzLnNoYWRvd1Jvb3QsIFwiZWxlbVwiLCB0aGlzLl9udW1iZXJTZWN0aW9uKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNldCBzZXRNYXNrKHByb3AgOiBQcm9wcykge1xuICAgICAgICB0aGlzLl9tYXNrID0gcHJvcC5fbWFzaztcbiAgICAgICAgY29uc29sZS5sb2coXCJzdGVwMVwiKTtcbiAgICAgICAgdGhpcy5sb2dpYygpO1xuICAgIH1cblxuICAgIGdldCBnZXRNYXNrKCkgOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fbWFzaztcbiAgICB9XG59XG5jdXN0b21FbGVtZW50cy5kZWZpbmUoXCJwaG9uZS12YWxpZGF0aW9uXCIsIHBob25lVmFsaWRhdGlvbkNvbXBvbmVudCk7XG52YXIgYSAgPSA8cGhvbmVWYWxpZGF0aW9uQ29tcG9uZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCc3Jyk7XG5pZiAoYSkge1xuICAgIGxldCBwIDogUHJvcHMgPSB7XG4gICAgICAgIF9tYXNrIDogJys3KDk4NSkwSUktKiotKionXG4gICAgfVxuICAgIGEuc2V0TWFzayA9IHA7XG5cbiAgICBjb25zb2xlLmxvZygnd3RmJylcblxuICAgIC8vIGEucmVuZGVyKCk7XG59IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKCdlcnInKVxufVxuXG5cblxuXG5cblxuXG5cbiJdLCJzb3VyY2VSb290IjoiIn0=